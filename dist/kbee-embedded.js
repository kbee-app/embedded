!function(){var t={};try{!function(e,n){if("+"!==new e("q=%2B").get("q")||"+"!==new e({q:"+"}).get("q")||"+"!==new e([["q","+"]]).get("q")||"q=%0A"!==new e("q=\n").toString()||"q=+%26"!==new e({q:" &"}).toString()||"q=%25zx"!==new e({q:"%zx"}).toString())throw e;t.URLSearchParams=e}(URLSearchParams)}catch(URLSearchParams){!function(e,n,r){"use strict";var a=e.create,i=e.defineProperty,o=/[!'\(\)~]|%20|%00/g,c=/%(?![0-9a-fA-F]{2})/g,s=/\+/g,u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},h={append:function(t,e){d(this._ungap,t,e)},delete:function(t){delete this._ungap[t]},get:function(t){return this.has(t)?this._ungap[t][0]:null},getAll:function(t){return this.has(t)?this._ungap[t].slice(0):[]},has:function(t){return t in this._ungap},set:function(t,e){this._ungap[t]=[n(e)]},forEach:function(t,e){var r=this;for(var a in r._ungap)r._ungap[a].forEach(i,a);function i(i){t.call(e,i,n(a),r)}},toJSON:function(){return{}},toString:function(){var t=[];for(var e in this._ungap)for(var n=w(e),r=0,a=this._ungap[e];r<a.length;r++)t.push(n+"="+w(a[r]));return t.join("&")}};for(var f in h)i(l.prototype,f,{configurable:!0,writable:!0,value:h[f]});function l(t){var e=a(null);switch(i(this,"_ungap",{value:e}),!0){case!t:break;case"string"==typeof t:"?"===t.charAt(0)&&(t=t.slice(1));for(var n=t.split("&"),o=0,c=n.length;o<c;o++){var s=(u=n[o]).indexOf("=");-1<s?d(e,g(u.slice(0,s)),g(u.slice(s+1))):u.length&&d(e,g(u),"")}break;case r(t):for(o=0,c=t.length;o<c;o++){var u;d(e,(u=t[o])[0],u[1])}break;case"forEach"in t:t.forEach(p,e);break;default:for(var h in t)d(e,h,t[h])}}function p(t,e){d(this,e,t)}function d(t,e,n){var a=r(n)?n.join(","):n;e in t?t[e].push(a):t[e]=[a]}function g(t){return decodeURIComponent(t.replace(c,"%25").replace(s," "))}function w(t){return encodeURIComponent(t).replace(o,v)}function v(t){return u[t]}t.URLSearchParams=l}(Object,String,Array.isArray)}!function(t){var e=!1;try{e=!!Symbol.iterator}catch(r){}function n(t,n){var r=[];return t.forEach(n,r),e?r[Symbol.iterator]():{next:function(){var t=r.shift();return{done:void 0===t,value:t}}}}"forEach"in t||(t.forEach=function(t,e){var n=this,r=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach((function(a){!a.length||a in r||(r[a]=n.getAll(a)).forEach((function(r){t.call(e,r,a,n)}))}))}),"keys"in t||(t.keys=function(){return n(this,(function(t,e){this.push(e)}))}),"values"in t||(t.values=function(){return n(this,(function(t,e){this.push(t)}))}),"entries"in t||(t.entries=function(){return n(this,(function(t,e){this.push([e,t])}))}),!e||Symbol.iterator in t||(t[Symbol.iterator]=t.entries),"sort"in t||(t.sort=function(){for(var t,e,n,r=this.entries(),a=r.next(),i=a.done,o=[],c=Object.create(null);!i;)e=(n=a.value)[0],o.push(e),e in c||(c[e]=[]),c[e].push(n[1]),i=(a=r.next()).done;for(o.sort(),t=0;t<o.length;t++)this.delete(o[t]);for(t=0;t<o.length;t++)e=o[t],this.append(e,c[e].shift())}),function(e){var n=e.defineProperty,r=e.getOwnPropertyDescriptor,a=function(e){var n=e.append;e.append=t.append,URLSearchParams.call(e,e._usp.search.slice(1)),e.append=n},i=function(t,e){if(!(t instanceof e))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+e.name)},o=function(o){var c,s,u=o.prototype,h=r(u,"searchParams"),f=r(u,"href"),l=r(u,"search");!h&&l&&l.set&&(s=function(e){function r(n,r){t.append.call(this,n,r),n=this.toString(),e.set.call(this._usp,n?"?"+n:"")}function a(n){t.delete.call(this,n),n=this.toString(),e.set.call(this._usp,n?"?"+n:"")}function i(n,r){t.set.call(this,n,r),n=this.toString(),e.set.call(this._usp,n?"?"+n:"")}return function(t,e){return t.append=r,t.delete=a,t.set=i,n(t,"_usp",{configurable:!0,writable:!0,value:e})}}(l),c=function(t,e){return n(t,"_searchParams",{configurable:!0,writable:!0,value:s(e,t)}),e},e.defineProperties(u,{href:{get:function(){return f.get.call(this)},set:function(t){var e=this._searchParams;f.set.call(this,t),e&&a(e)}},search:{get:function(){return l.get.call(this)},set:function(t){var e=this._searchParams;l.set.call(this,t),e&&a(e)}},searchParams:{get:function(){return i(this,o),this._searchParams||c(this,new URLSearchParams(this.search.slice(1)))},set:function(t){i(this,o),c(this,t)}}}))};try{o(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&o(URL)}catch(c){}}(Object)}(t.URLSearchParams.prototype);var e,n=(e=t.URLSearchParams)&&e.__esModule?e:{default:e};window.Kbee={render:function(t){var e=t.target,r=t.token,a=t.apiKey,i=t.spaceUrl;document.addEventListener("DOMContentLoaded",(function(){var t=window.location.pathname,o=new n.default(window.location.search),c=decodeURI(o.get("kbee")),s="string"==typeof e?document.querySelector(e):e;if("string"==typeof e&&!s)throw new Error('Target element with selector "'.concat(e,'" does not exist'));if(!(s instanceof Element||s instanceof HTMLDocument))throw new Error("Target element is not a valid DOM element");if(!i)throw new Error('"spaceUrl" is required');if(!r&&!a)throw new Error('One of "token" or "apiKey" is required');if(r)f(r);else{var u='{"url": "'.concat(i.split("://")[1],'","key":"').concat(a,'"}'),h=new XMLHttpRequest;h.addEventListener("readystatechange",(function(){4===this.readyState&&f(JSON.parse(this.responseText).jwt)})),h.open("POST","".concat(i,"/api/generateJWT")),h.send(u)}function f(e){s.innerHTML='<iframe src="'.concat(i).concat(c||"","?jwt=").concat(e,'" style="width:100%;height:100%;border:none"/>');var r=s.querySelector("iframe").contentWindow;window.addEventListener("popstate",(function(){var t=new n.default(window.location.search),r=decodeURI(t.get("kbee"));s.querySelector("iframe").src="".concat(i).concat(r||"","?jwt=").concat(e)})),window.addEventListener("message",(function(e){if(e.source===r&&!(e.data.indexOf("jwt=")>-1)){var a=new n.default(window.location.search);a.set("kbee",e.data);var i="".concat(t,"?").concat(a.toString());window.history.pushState({},"",i)}}))}}))}}}();
//# sourceMappingURL=kbee-embedded.js.map